--report to generate top 5 artist
WITH ranked_artists AS (
    SELECT u.userid AS artist_id, u.username AS artist_name, COUNT(DISTINCT a.artworkid) AS total_artworks_sold,
           DENSE_RANK() OVER (ORDER BY COUNT(DISTINCT a.artworkid) DESC) AS artist_rank
    FROM users u
    JOIN user_role ur ON u.roleid = ur.roleid
    JOIN artwork a ON u.userid = a.userid
    WHERE a.Status = 'Sold' AND ur.roleid = 2
    GROUP BY u.username, ur.rolename, u.userid
)
SELECT total_artworks_sold, artist_name, artist_id
FROM ranked_artists
WHERE artist_rank <= 5;

--Report for revenue generated by artist
SELECT TO_CHAR(TRUNC(o.OrderDateTime, 'MONTH'), 'Month') AS Month, SUM(o.TotalAmount) AS Revenue
FROM ORDERS o
JOIN ORDER_ITEMS oi ON o.OrderID = oi.OrderID
JOIN ARTWORK a ON oi.OrderItemsID = a.OrderItemsID
WHERE a.UserID = 16
AND EXTRACT(YEAR FROM o.OrderDateTime) = 2022
GROUP BY TRUNC(o.OrderDateTime, 'MONTH')
ORDER BY TRUNC(o.OrderDateTime, 'MONTH') ASC;

